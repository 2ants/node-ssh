module.exports=function(){function t(t){"use strict";var i=[];if("undefined"==typeof t.username&&i.push(new s("You must specify a valid username")),"undefined"==typeof t.host&&i.push(new s("You must specify a valid host")),"undefined"==typeof t.privateKey?i.push(new s("You must specify path to a privateKey")):n.existsSync(t.privateKey)?n.lstatSync(t.privateKey).isFile()||i.push(new s("The privateKey specified isn't page")):i.push(new s("The privateKey specified doesn't exist")),i.length>0)throw i;t.privateKey=n.readFileSync(t.privateKey),t.port=t.port||22,this.config=t,this.status=!1;try{this.conn=new e}catch(s){throw[s]}}var n=require("fs"),e=require("ssh2"),i=require("a-promise");return t.prototype.connect=function(){"use strict";return new i(function(t,n){try{this.conn.on("error",n),this.conn.on("ready",function(){this.status=!0,t()}.bind(this)),this.conn.connect(this.config)}catch(e){n(e)}}.bind(this))},t.prototype.mkdir=function(t){"use strict";return this.exec("mkdir -p "+t)},t.prototype.exec=function(t,n){"use strict";return n=n||{},new i(function(e,i){return this.status?(n.cwd&&(t="cd "+n.cwd+"; "+t),void this.conn.exec(t,function(t,n){if(t)return i(t);var s={stdout:"",stderr:""};n.on("close",function(){s.stdout=s.stdout.toString(),s.stderr=s.stderr.toString(),e(s)}).on("data",function(t){s.stdout=t}).stderr.on("data",function(t){s.stderr=t})})):i("Not yet connected to server")}.bind(this))},t.prototype.put=function(t,e){"use strict";return new i(function(i,s){return n.existsSync(t)?void this.conn.sftp(function(n,o){return n?s(n):void o.fastPut(t,e,function(n){return n?void("No such file"===n.message?this.mkdir(e.split("/").slice(0,-1).join("/")).then(function(){this.put(t,e).then(i)}):s(n)):i()}.bind(this))}.bind(this)):s("Local File doesn't exist")}.bind(this))},t.prototype.get=function(t,e){"use strict";return new i(function(i,s){this.conn.sftp(function(o,r){if(o)return s(o);var u=[],c=r.createReadStream(t);c.on("data",function(t){u.push(t.toString())}),c.on("error",function(t){s(t)}),c.on("close",function(){return u=u.join(""),e?void n.writeFile(e,u,function(t){t?s(t):i(u)}):i(u)})}.bind(this))}.bind(this))},t}();