module.exports=function(){function t(t){"use strict";var i=[];if("undefined"==typeof t.username&&i.push(new s("You must specify a valid username")),"undefined"==typeof t.host&&i.push(new s("You must specify a valid host")),"undefined"==typeof t.privateKey?i.push(new s("You must specify path to a privateKey")):e.existsSync(t.privateKey)?e.lstatSync(t.privateKey).isFile()||i.push(new s("The privateKey specified isn't page")):i.push(new s("The privateKey specified doesn't exist")),i.length>0)throw i;t.privateKey=e.readFileSync(t.privateKey),t.port=t.port||22,this.config=t,this.status=!1;try{this.conn=new n}catch(s){throw[s]}}var e=require("fs"),n=require("ssh2"),i=require("a-promise");return t.prototype.connect=function(){"use strict";return new i(function(t,e){try{this.conn.on("error",e),this.conn.on("ready",function(){this.status=!0,t()}.bind(this)),this.conn.connect(this.config)}catch(n){e(n)}}.bind(this))},t.prototype.exec=function(t,e){"use strict";return e=e||{},new i(function(n,i){return this.status?(e.cwd&&(t="cd "+e.cwd+"; "+t),void this.conn.exec(t,function(t,e){if(t)return i(t);var s={stdout:"",stderr:""};e.on("close",function(){s.stdout=s.stdout.toString(),s.stderr=s.stderr.toString(),n(s)}).on("data",function(t){s.stdout=t}).stderr.on("data",function(t){s.stderr=t})})):i("Not yet connected to server")}.bind(this))},t.prototype.put=function(t,n){"use strict";e.readFileSync(t.toString());return new i(function(i,s){return e.existsSync(t)?void this.conn.sftp(function(e,o){return console.log("I got the sftp connection"),e?s(e):void o.fastPut(t,n,function(e){return e?void("No such file"===e.message?this.mkdir(n.split("/").slice(0,-1).join("/")).then(function(){this.put(t,n).then(i)}):s(e)):i()})}.bind(this)):s("Local File doesn't exist")}.bind(this))},t.prototype.mkdir=function(t){"use strict";return this.exec("mkdir -p "+t)},t}();